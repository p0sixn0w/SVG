(function(c,b){function e(g){b.pushNotifications?b.pushNotifications.getUserToken(g):g(null)}function h(g,b,a){e(function(c){if(c)try{a||(a=[]),k(a)||a.push({name:"pushToken",value:c})}catch(e){}c=JSON.stringify({params:a,eventTypeKey:g,keyValue:b});d(c)})}function k(b){try{var a=!1;b.forEach(function(b){b.name&&"pushToken"===b.name&&(a=!0)});return a}catch(c){return!1}}function d(b){var a=new XMLHttpRequest;a.onerror=function(){};a.open("POST","https://esputnik.com/api/v1/event",!0);a.withCredentials=!0;
a.setRequestHeader("Authorization","Bearer eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI0NTI0ZWZhYTJkYzI2MGRmYTM4YTE1NDBlMWFkYjA1N2Q1YTMzNTFhMmU0NWRiOGEwZmJlNTM1ZmQ1OGU0ZDA0MmFlZmYwMzc0MWY1ZTE2MjI3MGU2OGY5YzIyMWRiMGEyZWUyYTMwOTU3MzI3ZmJjYWYyMjA1ZDIzNTFmYzYxNGIzYzBhYjMxMzQ3MjdhNDJlMTM4ZWQ3M2EwOGI0MjE0MDA4OWUwOWM5YjFiNjQ1N2YyMDRhOWQ4In0.Blnf3KZGx9XRmnVo9NOPHM7uavIHm8b9gYFbEWn37Ep204Q3rAYZ13A1QxnKNjAMFaO9lfrXZTX604jETQ8HjA");a.setRequestHeader("Content-Type","application/json");a.send(b)}var a=!1;c.__es_sdk?b=c.__es_sdk:(c.__es_sdk=b,b.isPushModuleOn=function(){return a});b.pushOn=function(g){b.pushNotifications&&!b.isPushModuleOn()?(a=!0,b.pushNotifications.init(g)):console.log("Push module unavailable")};b.sendEvent=function(a,b,c){h(a,b,c)};b.getPushToken=e;b.getPushContactId=function(a){b.pushNotifications?b.pushNotifications.getUserPushSubscriptionContactId(a):
a(null)};b.onWebPushSubscriptionChange=function(a){if(b.pushNotifications)b.pushNotifications.onSubscriptionChange(a,!0)}})(this,this.__es_sdk||{});
(function(D,w){function ga(){if("safari"===h.userAgent.name.toLowerCase()&&J()&&"default"===window.safari.pushNotification.permission(c.main.apnWebsitePushId).permission){var a={};a.domainId=c.main.APPLICATION_ID;a.userAgent=h.userAgent.name;a.userAgentVersion=h.userAgent.version;a.userAgentLanguage=window.navigator.I||window.navigator.language;a.OS=h.platform;a.subscriptionPage=window.location.href;window.safari.pushNotification.requestPermission(c.main.apnSubscriptionServiceUrl,c.main.apnWebsitePushId,
a,ha);p.close()}}function v(){try{!h.b||h.b&&c.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?ia():h.b&&!c.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?K.i():b.error("[registerController()] NO ACTIONS !!!")}catch(a){b.log("[registerController()] handle error ",a)}}function J(){return"safari"in window&&"pushNotification"in window.safari}function q(){return J()?window.safari.pushNotification.permission(c.main.apnWebsitePushId):window.Notification}function S(a){b.log("[init()] Started..");
var d=c.urls,e=T;a&&a["service-worker"]&&a["service-worker"].relUrl?e=a:b.log("Custom service worker script url is not provided, use default");d.SERVICE_WORKER_URL_HTTPS=e["service-worker"].relUrl;d=c.subscription;e=T;a&&a["service-worker"]&&a["service-worker"].scope||(b.log("Custom service worker scope is not provided, use default"),a=e);d.serviceWorkerScope=a["service-worker"].scope;b.log("Configuration: ");b.log("Target Domain: ",c.main.targetDomain);b.log("Proxy Domain: ",c.main.proxyDomain);
b.log("Application ID: ",c.main.APPLICATION_ID);b.log("Notifications Service: ",c.main.notificationsService);b.log("Apple Push Notification Website Push ID: ",c.main.apnWebsitePushId);b.log("Show Subscription IFrame Result [s]: ",c.subscription.timeSuccessShow);b.log("Timeout on ignore prompt: ",c.subscription.timeoutIgnorePopover);b.log("Timeout on block prompt: ",c.subscription.timeBlockPopover);b.log("Validation period: ",c.validation.validationPeriod);b.log("Is Validation Enabled: ",c.validation.isValidationEnabled);
b.log("Validation Window Width: ",c.validation.validationWindowWidth);b.log("Validation Window Height: ",c.validation.validationWindowHeight);b.log("Token Data Update Period: ",c.updates.tokenDataUpdatePeriod);b.log("Is show special for Https: ",c.main.IS_SHOW_SPECIAL_FOR_HTTPS);b.log("Use client proxy for special Https: ",c.main.USE_CLIENT_PROXY_FOR_SPECIAL_HTTPS);b.log("App Manifest URL: ",c.urls.APP_MANIFEST_URL_HTTPS);b.log("Service Worker URL: ",c.urls.SERVICE_WORKER_URL_HTTPS);b.log("Show IFrame for Https: ",
c.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS);b.log("Show Prompt Delay: ",c.subscription.SHOW_PROMPT_DELAY);b.log("Is logger enabled: ",c.logging.IS_LOGGER_ENABLED);h.platform=y.s();h.userAgent=y.w();h.b=y.b();h.isSupported=y.F();h.h=y.D();b.log("[init()] Environment: ",h);b.log("");ja()}function ha(a){if("denied"===a.permission)b.log("User refused push notifications"),"true"===c.subscription.FLOATING_BUTTON_ENABLED&&("true"!==c.subscription.FLOATING_BUTTON_REMINDER_ENABLED||"true"===c.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&
0===1E3*c.subscription.FLOATING_BUTTON_REMINDER_DELAY)&&p.c();else if("granted"===a.permission){b.log("User allow push notifications");var d={};d.token=a.deviceToken;z.j(d)}}function ka(){b.log("[checkSubscriptionInGCM()] Started.. ");navigator.serviceWorker.ready.then(function(a){try{a.pushManager.getSubscription().then(function(d){b.log("[checkSubscriptionInGCM()] OK, subscription =",d);if(d){var e=L(d),f={};f.token=e;f.auth=E(d.getKey("auth"));f.p256dh=E(d.getKey("p256dh"));z.j(f)}else la(a)})["catch"](function(a){b.error("[checkSubscriptionInGCM()] FAIL: ",
a)})}catch(d){}})}function la(a){var d={userVisibleOnly:!0};F()&&(d.applicationServerKey=ma(c.subscription.vapidApplicationServerKey));a.pushManager.subscribe(d).then(function(a){var d=L(a),b={};b.token=d;b.auth=E(a.getKey("auth"));b.p256dh=E(a.getKey("p256dh"));z.j(b)})["catch"](function(a){"true"===c.subscription.FLOATING_BUTTON_ENABLED&&("true"!==c.subscription.FLOATING_BUTTON_REMINDER_ENABLED||"true"===c.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&0===1E3*c.subscription.FLOATING_BUTTON_REMINDER_DELAY)&&
p.c();b.warn("[subscribe()] FAIL: ",a)})}function F(){var a=c.subscription.vapidApplicationServerKey;return a&&0!==a.length}function ma(a){var d="=".repeat((4-a.length%4)%4);a=(a+d).replace(/\-/g,"+").replace(/_/g,"/");a=window.atob(a);for(var d=new Uint8Array(a.length),b=0;b<a.length;++b)d[b]=a.charCodeAt(b);return d}function E(a){return btoa(String.fromCharCode.apply(null,new Uint8Array(a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function L(a){b.log("[parseSubscriptionEndpoint()] Started... ");
a=a.subscriptionId?a.subscriptionId:a.endpoint;b.log("[parseSubscriptionEndpoint()] OK, subscriptionEndpoint = ",a);return a}function ja(){k.get("Contacts",function(a){a.target.result&&a.target.result.value&&G(a.target.result.value)})}function G(a){"localStorage"in window&&void 0!==a&&null!==a&&localStorage.setItem("esWebPushContactId",a)}function M(){for(var a=0;a<U.length;a++){var d;a:{var b=document.getElementById(U[a]);if(b)try{d=b.innerHTML.trim();break a}catch(f){}d=null}if(d&&/^\S+@\S+$/.test(d))return d}return null}
function V(a,d){k.get("cmms",function(b){b.target.result?d(a,b.target.result.value):d(a,null)},function(){d(a,null)})}function W(a,d){var e=M();e&&z.l(a,"5",e,d,function(a,d){try{if(a&&d&&(d=JSON.parse(d),d.cmms&&k.a({key:"cmms",value:d.cmms}),1==d.type)){var e=d.value;k.a({key:"Contacts",value:d.value},function(){G(e)})}}catch(c){b.error("[bind()] ",c)}})}function na(a){a=a.scriptURL;a=0==a.indexOf(window.location.origin)?a.substring(window.location.origin.length):void 0;return a&&-1!=a.indexOf(c.urls.SERVICE_WORKER_URL_HTTPS)}
function oa(){k.remove("SID",function(){try{h.b&&!c.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?X()["catch"](function(a){b.log("error unsubscribing",a)}).then(function(){v()}):v()}catch(a){}},function(a){b.log("Failed to remove subscription info from storage: "+a.target.errorCode)})}function X(){return navigator.serviceWorker.ready.then(function(a){try{return a.pushManager.getSubscription().then(function(a){if(a)return a.unsubscribe()})["catch"](function(){})}catch(d){return Promise.reject(d)}})}
function Y(a){var d=null;b.log("[init()] check utm labels:",window.location.search);window.location.search.replace(/^\?/,"").split("&").forEach(function(e){e=e.split("=");a==e[0]&&(b.log("[init()] contactId from url =",e[1]),0===e[1]%1&&(d=e[1]))});var e;try{e=!isNaN(d-parseInt(d))}catch(f){e=!1}return e?d:null}function ia(){b.log("[showCustomPopOverDialogController()] Starting...");t.C(k,pa);try{qa(function(a,d){a&&ra(function(a){try{a||Z(function(a){try{if(a){var e=new Date(d),l=new Date;"true"===
c.subscription.FLOATING_BUTTON_REMINDER_ENABLED?x(e,l)>1E3*c.subscription.FLOATING_BUTTON_REMINDER_DELAY&&p.c():x(e,l)>864E5*c.subscription.timeBlockPopover&&t.f()}else{var r=new Date;"true"===c.subscription.FLOATING_BUTTON_ENABLED&&"true"===c.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&"denied"===q().permission?p.c():(!d||x(d,r)>1E3*c.subscription.timeoutIgnorePopover)&&"denied"!==q().permission&&t.f()}}catch(m){b.error("check before iframe",m)}})}catch(f){b.error("check before iframe",f)}})})}catch(a){b.error("check before iframe",
a)}}function qa(a){k.get("userPrompted",function(d){var e=null;void 0===d.target.result?b.log("New visitor, try to subscribe ..."):void 0!==d.target.result.value&&(e=new Date(d.target.result.value.date));a(!0,e)},function(){a(!1,null)})}function Z(a){k.get("refused",function(d){a(d.target.result)},function(d){b.log("Failed to retrieve refused key, error: "+d.target.errorCode);a(null)})}function ra(a){k.get("SID",function(d){a(d.target.result)},function(d){b.log("Failed to retrieve ID key, error: "+
d.target.errorCode);a(null)})}function pa(){try{b.log("Subscription denied"),k.a({key:"refused",value:(new Date).toString()})}catch(a){}}function x(a,d){return d.getTime()-a.getTime()}function aa(){var a=window.location.protocol;return c.main.IS_SHOW_SPECIAL_FOR_HTTPS&&"https:"===a?!0:!1}function ba(a,d,b){var c=new Date;c.setTime(c.getTime()+864E5*b);document.cookie=a+"="+d+"; path=/;"+("expires="+c.toUTCString())}function N(a){function d(d,c,g){b.log("[sendResultCallback()] save to indexedDb..");
b.log("[sendResultCallback()]",d,c,g);try{if(d&&g){b.log("[sendResultCallback()] Starting save token to indexedDb:",g.token);var l={sid:g.token,bnd:c};F()&&a.auth&&(l.auth=a.auth);F()&&a.p256dh&&(l.p256dh=a.p256dh);k.a({key:"SID",value:l});k.a({key:"activeness.check",value:(new Date).getTime()});g.cmms&&k.a({key:"cmms",value:g.cmms});g.bindings?(b.log("[sendResultCallback()] Starting save to indexedDb:",g.bindings),g.bindings.forEach(function(a){if(1==a.type){var d=a.value;k.a({key:"Contacts",value:a.value},
function(){G(d)});try{g.status&&"NEW"===g.status&&H.rememberEvent({type:"subscription-change",data:{type:"new-subscription",token:g.token,contactId:a.value}})}catch(e){b.error("[evt error()]",e)}}else 2==a.type?ba("es-bind-id",a.value,1095):3==a.type&&k.a({key:"sw-md5",value:{hash:a.value,date:(new Date).toString()}})})):b.warn("[sendResultCallback()] return, data.bindings = ",g.bindings)}else b.warn("[sendResultCallback()] return, subscription not saved")}catch(r){b.error("[syncSubscription()]",
r)}}b.log("[syncSubscription()]",a);k.get("SID",function(e){try{if(!e.target.result)ca(a,d);else if(e.target.result.value!==a.token){var c=e.target.result.value;b.warn("[[syncSubscription()]] old data in indexedDB",c,a);da(c,a,d)}}catch(g){b.error("[syncSubscription()]",g)}},function(){b.error("Failed to get SID data")})}function ca(a,d){b.log("[sendSubscriptionToService()]",a);try{var e=new XMLHttpRequest;e.onreadystatechange=function(){try{4==e.readyState&&(200==e.status?d(!0,!0,JSON.parse(e.responseText)):
409==e.status?d(!0,!0,JSON.parse(e.responseText)):(b.warn("Bad Response status = ",e),d(!1,!1,null)))}catch(a){b.error("[sendSubscriptionToService()]",a)}};e.open("PUT",c.main.notificationsService+"/v1/subscribe/",!0);e.setRequestHeader("Content-Type","application/json");var f={};f.domainId=c.main.APPLICATION_ID;f.endpoint=a.token;F()&&(a.auth&&a.p256dh&&(f.keys={},f.keys.auth=a.auth,f.keys.p256dh=a.p256dh),f.subscriptionType="VAPID");f.userAgent=h.userAgent.name;f.userAgentVersion=h.userAgent.version;
f.userAgentLanguage=window.navigator.I||window.navigator.language;f.OS=h.platform;f.subscriptionPage=window.location.href;f.binding=sa();e.send(JSON.stringify(f))}catch(g){b.error("[sendSubscriptionToService()]",g)}}function ta(a,d){try{var e=new XMLHttpRequest;e.onreadystatechange=function(){try{var a=!0;4==e.readyState&&(410==e.status&&(a=!1),k.a({key:"activeness.check",value:(new Date).getTime()},function(){d(a)}))}catch(c){b.error("[checkSubscriptionIsActive()]",c)}};e.open("GET",c.main.notificationsService+
"/v1/wps/"+c.main.APPLICATION_ID+"/subscription/state?sid="+encodeURIComponent(a),!0);e.setRequestHeader("Content-Type","application/json");e.send()}catch(f){d(!0)}}function sa(){var a={},d;if(n&&0!==n.length)d=n;else a:{if("localStorage"in window&&(d=localStorage.getItem("esWebPushContactId",d),void 0!==d&&null!==d))break a;d=null}d&&""!=d?(a.type="1",a.value=d):M()?(a.type="5",a.value=M()):""!=I&&(a.type="2",a.value=I);return a}function da(a,d,c){b.log("Send updated subscription to server:"+d);
b.log("Old subscription:"+a);c(!0,null)}function ea(a,d){k.get(a,function(a){try{var b=a.target.result;a=null;b&&(a=new Date(b.value));d(a)}catch(c){d(null)}})}function ua(a){ea("validation",function(d){if(null!=d&&x(d,new Date)<c.validation.validationPeriod)return a(!1);a(!0)})}function va(a){ea("activeness.check",function(d){if(null!=d){try{var b=parseInt(d);Number.isNaN(b)||(d=b)}catch(c){}if(259200000>x(d,new Date)){a(!1);return}}a(!0)})}function wa(a,d,e){try{ua(function(f){if(f){var g=
new XMLHttpRequest;g.onreadystatechange=function(){try{4==g.readyState&&200==g.status&&(O="true"===g.responseText?!0:!1,b.log("Is token valid: "+O),O?e():xa(a,d),k.a({key:"validation",value:(new Date).toString()}))}catch(c){b.log("Failed to update service worker: "+c)}};null!=a&&(g.open("GET",c.main.notificationsService+"/v1/subscription/validate?value="+a+"&app="+c.main.APPLICATION_ID,!0),g.setRequestHeader("Content-Type","application/json"),g.send())}else e()})}catch(f){b.log("Error: "+f)}}function xa(a,
d){var e=new XMLHttpRequest;e.onreadystatechange=function(){try{4==e.readyState&&200==e.status&&(b.log("Token is set to inactive"),k.remove("SID",function(){b.log("SID key is removed from storage");d()},function(a){b.log("Failed to remove subscription info from storage: "+a.target.errorCode)}))}catch(a){b.log("Failed to deactivate token: "+a)}};e.open("PUT",c.main.notificationsService+"/v1/subscription/"+a+"/inactive",!0);e.setRequestHeader("Content-Type","application/json");e.send()}D.__es_sdk||
(D.__es_sdk={});D.__es_sdk.pushNotifications=w;var T={manifest:{included:!1,relUrl:"/manifest.json"},"service-worker":{relUrl:"/sw.js",scope:"/"}},c={main:{targetDomain:"https://comfy.ua",proxyDomain:"https://comfy-push.esputnik.com",APPLICATION_ID:"A81FCD6B-1B1D-49B2-852C-BFB84B7524CB",notificationsService:"https://push.esputnik.com",apnWebsitePushId:"",apnSubscriptionServiceUrl:"https://push.esputnik.com/v1/subscribe/apns/safari",isApnEnabled:false,IS_SHOW_SPECIAL_FOR_HTTPS:true,USE_CLIENT_PROXY_FOR_SPECIAL_HTTPS:false,
IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS:!1},subscription:{timeSuccessShow:8,timeoutIgnorePopover:1000,timeBlockPopover:30,SHOW_PROMPT_DELAY:10,promptMode:1,subscriptionPromptAcceptBtnText:"Разрешить",subscriptionPromptDeclineBtnText:"Запретить",subscriptionPromptText:"Кликните &quot;Разрешить&quot; чтобы получать уведомления от http://comfy.ua/",subscriptionPopoverType:2,
vapidApplicationServerKey:"BMI1_t53d_u6sHG7fXB6WBR7kd0m2fFOzbRyM8aeBCw3S8roGdcyMaUPtimttN0Pun2AHlA_nrWZkNW2L-WgGkg",serviceWorkerScope:"/",FLOATING_BUTTON_ENABLED:"null",FLOATING_BUTTON_BACKGROUND_COLOR:"null",FLOATING_BUTTON_SIDE:"null",FLOATING_BUTTON_BOTTOM_DIMENSION:"null",FLOATING_BUTTON_SIDE_DIMENSION:"null",FLOATING_BUTTON_ANIMATION_TYPE:"null",FLOATING_BUTTON_REMINDER_ENABLED:"null",
FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT:"${FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT}",FLOATING_BUTTON_REMINDER_BLOCKED_TEXT:"${FLOATING_BUTTON_REMINDER_BLOCKED_TEXT}",FLOATING_BUTTON_REMINDER_DELAY:"null"},validation:{validationPeriod:86400000,isValidationEnabled:false,validationWindowWidth:500,validationWindowHeight:300},updates:{tokenDataUpdatePeriod:604800000},
urls:{SERVICE_WORKER_URL_HTTPS:"/sw.js"},logging:{IS_LOGGER_ENABLED:false}},U=["EsputnikEmail","esputnikemail","esputnikEmail","eSputnikEmail","Esputnikemail"],n="",I="",O=!1,H={};(function(a){var d={},c={};a.rememberEvent=function(a){try{if(c[a.type]||(c[a.type]=[]),c[a.type].push(a),d[a.type])for(var g=0;g<d[a.type].length;g++)if(d[a.type][g])try{d[a.type][g](a)}catch(l){b.log("failed to fire evt",l)}}catch(l){b.log("Failed to remember event",l)}};a.registerListener=function(a,
b,l){d[a]||(d[a]=[]);if(l&&(l=c[a]))for(var r=0;r<l.length;r++)b(l[r]);d[a].push(b)}})(H);var ya={onPageLoad:1,byElementClick:2},P={"default":1,topPanel:2,bottomPanel:3},h={platform:null,userAgent:null,isSupported:!1,b:!1,h:!1},K={O:v,i:function(){b.log("[registerServiceWorker()] Started...");J()?ga():"serviceWorker"in navigator&&navigator.serviceWorker.register(c.urls.SERVICE_WORKER_URL_HTTPS,{scope:c.subscription.serviceWorkerScope}).then(function(a){b.log("[registerServiceWorker()] sw registered for scope: ",
a.scope);b.log("[registerServiceWorker()] OK:",a);b.log("");ka()})["catch"](function(a){b.error("[registerServiceWorker()] FAIL:",a)})}},Aa={bind:function(){b.log("[bind()] Starting...");n=Y("utm_content");I=za.o("es-bind-id");b.log("[bind()] userId =",n);b.log("[bind()] uuid =",I);k.get("SID",function(a){function d(a){a&&""!==a&&ta(a,function(a){a?l():oa()})}function e(){var b=a.target.result.value.sid;"serviceWorker"in navigator&&aa()?navigator.serviceWorker.getRegistration().then(function(a){a&&
a.active&&na(a.active)&&a.pushManager.getSubscription().then(function(a){a&&(a=L(a))&&-1!=a.indexOf(b)&&d(b)})["catch"](function(){})})["catch"](function(){}):d(b)}function f(d){var c=a.target.result.value.sid;z.l(c,"1",n,null,function(a,e){try{if(a&&e){e=JSON.parse(e);var g=e.value;1==e.type&&k.a({key:"Contacts",value:e.value},function(){G(g);try{H.rememberEvent({type:"subscription-change",data:{type:"contact-id-update",token:c,contactId:d,newContactId:e.value}})}catch(a){b.error("[evt error()] ",
a)}})}}catch(f){b.error("[bind()] ",f)}})}function g(){if(a.target.result.value){var d=a.target.result.value.sid;k.get("Contacts",function(a){try{if(a.target.result){var c=a.target.result.value;n&&""!==n&&n!=c?f(c):V(d,W)}else n&&""!==n?f(null):V(d,W)}catch(e){b.log("[bind()] ",e)}})}}function l(){var d=a.target.result.value.sid;c.validation.isValidationEnabled&&!h.b?wa(d,v,g):g()}b.log("[bind()] Starting...");b.log("[bind()]  Check SID in DB: ",a.target.result);try{window.localStorage.setItem("es_webpush_inited",
"1")}catch(r){}a.target.result?va(function(a){a?e():l()}):(b.log("[bind()] No SID in DB, try to register"),c.subscription.FLOATING_BUTTON_ENABLED&&"granted"===q().permission?K.i():h.b&&!c.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?navigator.serviceWorker.getRegistrations().then(function(a){a&&0<a.length?X().then(function(){v()}):v()})["catch"](function(){}):v())},function(){b.log("Failed to get data")});b.log("[bind()] Finish");b.log("")}},za={o:function(a){var d="";a+="=";for(var b=document.cookie.split(";"),
c=0;c<b.length;c++){for(var g=b[c];" "==g.charAt(0);)g=g.substring(1);0==g.indexOf(a)&&(d=g.substring(a.length,g.length))}return d},T:ba,L:function(){document.cookie=name+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}},z={R:ca,l:function(a,d,e,f,g){b.log("[sendBindRequestToService()] Starting...");try{var l=new XMLHttpRequest;l.onreadystatechange=function(){try{4===l.readyState&&(200==l.status?g(!0,l.responseText):g(!1,null))}catch(a){b.error("[sendBindRequestToService()]",a)}};l.open("PUT",c.main.notificationsService+
"/v1/bind/",!0);l.setRequestHeader("Content-Type","application/json");l.send(JSON.stringify({token:a,type:d,value:e,appId:c.main.APPLICATION_ID,cmms:f}))}catch(r){b.error("[sendBindRequestToService()]",r)}},S:da,j:N,P:function(){b.log("Try Register User Visit");k.get("SID",function(a){b.log("Check SID in DB: ",a.target.result);a.target.result?(b.log("Register User Visit"),a=a.target.result.value.sid,D.__es_sdk.M("user_visited_site",a,[{name:"sid",value:a}])):b.log("No SID in DB")})}},b={log:function(){console&&
b.isEnabled()&&console.log.apply(console,arguments)},warn:function(){console&&b.isEnabled()&&console.warn.apply(console,arguments)},error:function(){console&&b.isEnabled()&&console.error.apply(console,arguments)},isEnabled:function(){return/true/.test(c.logging.IS_LOGGER_ENABLED)}},y={N:S,w:function(){var a,d=navigator.userAgent,b=d.match(/(opera|chrome|safari|firefox|msie|yabrowser|trident(?=\/))\/?\s*(\d+)/i)||[],c=d.match(/(edge?(?=\/))\/?\s*(\d+)/i)||[];if("Edge"===c[1]||-1!=d.indexOf("Edg"))return{name:c[1],
version:c[2]};if(/trident/i.test(b[1]))return a=/\brv[ :]+(\d+)/g.exec(d)||[],{name:"IE",version:a[1]||""};if("Chrome"===b[1]){a=d.match(/\bOPR\/(\d+)/);if(null!=a)return{name:"Opera",version:a[1]};if(a=d.match(/\bYaBrowser\/(\d+)/),null!=a)return{name:"Yandex",version:a[1]}}return b=b[2]?[b[1],b[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=d.match(/version\/(\d+)/i))&&b.splice(1,1,a[1]),{name:b[0],version:b[1]}},s:function(){var a="Windows FreeBSD Android iPhone Linux Mac".split(" ");
for(i=0;i<a.length;i++)if(-1!=navigator.userAgent.indexOf(a[i]))return a[i];return""},b:aa,F:function(){if("iPhone"===h.platform||""===h.platform)return!1;if("chrome"===h.userAgent.name.toLowerCase()&&42<=parseFloat(h.userAgent.version)||"firefox"===h.userAgent.name.toLowerCase()&&44<=parseFloat(h.userAgent.version))return!0;if("safari"===h.userAgent.name.toLowerCase())return c.main.isApnEnabled&&10<=h.userAgent.version;if("opera"===h.userAgent.name.toLowerCase()&&43<=parseFloat(h.userAgent.version)||
"yandex"===h.userAgent.name.toLowerCase()&&18<=parseFloat(h.userAgent.version))return!0},D:function(){var a=window.location.href;-1===c.main.targetDomain.indexOf("://www.")&&(a=a.replace("://www.","://"));return 0===a.indexOf(c.main.targetDomain)}},fa={g:S,m:function(){b.log("[checkData()] Started..");h.isSupported||b.warn("[checkData()] FAIL, Environment is not supported:",h);h.h||b.warn("[checkData()] FAIL,this  is not target domain",h);b.log("[checkData()] Ok");b.log("")},J:Y};w.init=function(a){try{var d=
function(){try{fa.g(a),fa.m(),h.isSupported&&h.h&&Aa.bind()}catch(d){b.log("[main()] handle error ",d)}};c.subscription.promptMode===ya.onPageLoad?setTimeout(d,1E3*c.subscription.SHOW_PROMPT_DELAY):document.addEventListener("click",function(a){a.target.closest(".es-push-prompt-init")&&(b.log("init subscription by click"),d())},!1)}catch(e){b.log("[init] handle error ",e)}};w.getUserToken=function(a){k.get("SID",function(b){var c=null;b.target.result&&(c=b.target.result.value.sid);a(c)})};w.getUserPushSubscriptionContactId=
function(a){k.get("Contacts",function(b){var c=null;b.target.result&&(c=b.target.result.value);try{c=parseInt(c),isNaN(c)&&(c=null)}catch(f){c=null}a(c)})};w.onSubscriptionChange=function(a,b){H.registerListener("subscription-change",a,b)};var k=function(){function a(a,c){try{var d=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open("es-push-integration",1);d.onsuccess=function(b){try{e=b.target.result,a()}catch(c){}};d.onerror=function(a){try{b.log("DB opening error: "+
a.target.errorCode),c()}catch(d){}};d.onupgradeneeded=function(a){try{a.target.result.createObjectStore("integration-data",{keyPath:"key"})}catch(b){}}}catch(r){}}function c(d){try{e?d():a(function(){d()},function(){b.log("DB init failed")})}catch(g){b.log("Error occurred: "+g)}}var e=null;return{a:function(a,b,l){c(function(){var c=e.transaction(["integration-data"],"readwrite").objectStore("integration-data").put(a);c.onsuccess=b;c.onerror=l})},remove:function(a,b,l){c(function(){var c=e.transaction(["integration-data"],
"readwrite").objectStore("integration-data")["delete"](a);c.onsuccess=b;c.onerror=l})},get:function(a,b,l){c(function(){var c=e.transaction(["integration-data"],"readonly").objectStore("integration-data").get(a);c.onsuccess=b;c.onerror=l})}}}(),p=function(){function a(a,b){function d(){f.querySelector(".js-webPushSubscriptionBlockedTip").style.display="none"}var m=document.createElement("div"),h="background-color: "+c.subscription.FLOATING_BUTTON_BACKGROUND_COLOR+"; display: none;",k="bottom: "+c.subscription.FLOATING_BUTTON_BOTTOM_DIMENSION+
";\n                                z-index: 2147483647; \n                                "+c.subscription.FLOATING_BUTTON_SIDE+": "+c.subscription.FLOATING_BUTTON_SIDE_DIMENSION+";";try{m.classList.add("webPushSubscriptionPreview--component"),m.setAttribute("style",k),m.innerHTML='\n                    <div class="js-webPushSubscriptionPreview webPushSubscriptionPreview" style="display: none;">\n                        <div class="webPushSubscriptionPreview--inner">\n                            <span class="webPushSubscriptionPreview--text">'+
c.subscription.subscriptionPromptText+'</span>\n                            <div class="webPushSubscriptionPreview--confirm">\n                                <button id="es-push-decline-btn" class="webPushSubscriptionPreview--button webPushSubscriptionPreview--button__decline">\n                                    '+c.subscription.subscriptionPromptDeclineBtnText+'\n                                 </button>\n                                 <button id="es-push-accept-btn" class="webPushSubscriptionPreview--button webPushSubscriptionPreview--button__accept">\n                                    '+
c.subscription.subscriptionPromptAcceptBtnText+'\n                                 </button>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="js-webPushSubscriptionAlert webPushSubscriptionPreview--widgetTooltip webPushSubscriptionPreview--widgetTooltip__notBlocked" style="display: none;">'+c.subscription.FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT+'</div>\n                    <div class="js-webPushSubscriptionBlockedTip webPushSubscriptionPreview--widgetTooltip" style="display: none;">\n                        <div class="widgetTooltip--text">\n                            <span>'+
c.subscription.FLOATING_BUTTON_REMINDER_BLOCKED_TEXT+'</span>\n                            <span class="widgetTooltip--close close-prompt"></span>\n                        </div>\n                        <div class="widgetTooltip--image"></div>\n                    </div>\n                    <div class="js-bell-widget-icon widget-icon-wrap widget-icon-'+c.subscription.FLOATING_BUTTON_SIDE+" "+c.subscription.FLOATING_BUTTON_ANIMATION_TYPE+'" style="'+h+'">\n                        <img alt="widget icon" src="'+
c.main.notificationsService+"/push/resource/"+c.main.APPLICATION_ID+"/floating_button?decache="+(new Date).getTime()+'">\n                    </div>\n                ',m.style.visibility="hidden",m.querySelector(".widgetTooltip--close").addEventListener("click",d),m.querySelector("#es-push-decline-btn").addEventListener("click",function(){e();("true"!==c.subscription.FLOATING_BUTTON_REMINDER_ENABLED||"true"===c.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&0===1*c.subscription.FLOATING_BUTTON_REMINDER_DELAY)&&
p.c();b()}),m.querySelector("#es-push-accept-btn").addEventListener("click",function(){e();a()}),m.querySelector(".js-bell-widget-icon").addEventListener("click",function(){Z(function(a){try{"default"===q().permission&&(a?x(new Date(a&&a.value),new Date)>1E3*c.subscription.FLOATING_BUTTON_REMINDER_DELAY&&(t.f(),m.querySelector(".js-webPushSubscriptionAlert").style.display="none"):(t.f(),m.querySelector(".js-webPushSubscriptionAlert").style.display="none"))}catch(b){}})})}catch(u){}return m}function d(a,
d){try{var f="push-notification-popover",h="push-notification-prompt-buttons";c.subscription.subscriptionPopoverType===P.topPanel?(f="push-notification-popover-top",h="push-notification-prompt-inline-buttons"):c.subscription.subscriptionPopoverType===P.bottomPanel&&(f="push-notification-popover-bottom",h="push-notification-prompt-inline-buttons");var k=document.createElement("div");k.setAttribute("class","push-notification-prompt "+f);var n=document.createElement("div");n.setAttribute("class","push-notification-prompt-message");
var u=document.createElement("div"),p=document.createElement("img");p.setAttribute("class","push-notification-bell-icon");p.setAttribute("width","14");p.setAttribute("height","14");p.setAttribute("src",c.main.notificationsService+"/img/subscription-notify-icon.svg");u.appendChild(p);u.setAttribute("class","push-notification-prompt-message-text");var A=document.createElement("div");A.setAttribute("class",h);var B=document.createElement("button");B.setAttribute("class","push-notification-prompt-btn push-notification-accept-btn");
B.setAttribute("type","button");B.onclick=a;B.innerHTML=c.subscription.subscriptionPromptAcceptBtnText;var C=document.createElement("button");C.setAttribute("class","push-notification-prompt-btn push-notification-disallow-btn");C.setAttribute("type","button");C.onclick=function(){e();d()};C.innerHTML=c.subscription.subscriptionPromptDeclineBtnText;A.appendChild(C);A.appendChild(B);n.appendChild(u);if(c.subscription.subscriptionPopoverType===P["default"]){n.appendChild(A);var Q=document.createElement("div");
Q.setAttribute("class","push-prompt-text");Q.innerHTML=c.subscription.subscriptionPromptText;u.appendChild(Q)}else u.innerHTML+=c.subscription.subscriptionPromptText,u.appendChild(A);k.appendChild(n);var R=document.createElement("span");R.setAttribute("class","close-prompt");R.onclick=function(){e()};n.appendChild(R);k.style.visibility="hidden";return k}catch(t){return b.error("prompt ctor error: ",t),null}}function e(){try{null!=f&&(f.style.visibility="hidden",f.classList.contains("webPushSubscriptionPreview--component")&&
Array.from(f.children).forEach(function(a){a.style.display="none"}))}catch(a){b.error("prompt widget error:",a)}}var f=null;return{g:function(b,e){var h=document.getElementsByTagName("head")[0],m=document.createElement("link");m.rel="stylesheet";m.type="text/css";m.href=c.main.notificationsService+"/resource/"+c.main.APPLICATION_ID+"/es-subscription-prompt-style.css";h.appendChild(m);f="true"===c.subscription.FLOATING_BUTTON_ENABLED?a(b,e):d(b,e);null!=f&&document.body.appendChild(f)},show:function(){try{null!=
f&&(f.style.visibility="visible",f.classList.contains("webPushSubscriptionPreview--component")&&Array.from(f.children).forEach(function(a){a.classList.contains("js-webPushSubscriptionPreview")&&(a.style.display="block");a.classList.contains("js-bell-widget-icon")&&(a.style.display="flex")}))}catch(a){b.error("prompt widget error:",a)}},close:e,G:function(){},H:function(){},c:function(){try{if(null!=f){f.style.visibility="visible";var a=f.querySelector(".js-webPushSubscriptionBlockedTip"),c=f.querySelector(".js-webPushSubscriptionAlert"),
d=f.querySelector(".js-webPushSubscriptionPreview");Array.from(f.children).forEach(function(b){b.classList.contains("js-bell-widget-icon")?(b.style.display="flex",b.addEventListener("mouseenter",function(){d&&"none"!==d.style.display||a&&"none"!==a.style.display||"denied"===q().permission||(c.style.display="block")}),b.addEventListener("mouseleave",function(){d&&"none"!==d.style.display||a&&"none"!==a.style.display||"denied"===q().permission||(c.style.display="none")}),b.addEventListener("click",
function(){"denied"===q().permission&&(a.style.display="block",c.style.display="none")})):b.style.display="none"})}}catch(e){b.error("prompt widget error:",e)}}}}(),t=function(){function a(){window.addEventListener("message",function(a){try{if(0==a.origin.indexOf(c.main.proxyDomain))if("pong"==a.data)clearInterval(v),d();else if("SYNC"==a.data)q.a({key:"synced",value:(new Date).toString()});else{var e=1E3*c.subscription.timeSuccessShow;if("refused"==a.data)n();else if(0===a.data.indexOf("SID|")){var f=
a.data.split("|");if(2==f.length){var g={};g.token=f[1];N(g)}}else if(0===a.data.indexOf("SDO|"))try{f=a.data.split("|"),2==f.length&&(g=JSON.parse(f[1]),N(g))}catch(h){}setTimeout(function(){try{null!=m&&m.close()}catch(a){b.error("iframe: ",a)}},e)}}catch(h){b.error("iframe: ",h)}},!1)}function d(){try{p.close()}catch(a){b.error("iframe: ",a)}}function e(){var a=window.location.protocol;if("true"===c.subscription.FLOATING_BUTTON_ENABLED||!c.main.proxyDomain&&"https:"===a)d(),K.i();else try{m=window.open(c.main.proxyDomain+
"/subscription/"+c.main.APPLICATION_ID,"_blank","scrollbars=yes, width=500, height=500, top="+(g()/2-250+k())+", left="+(f()/2-250+h())),window.focus&&m.focus(),v=setInterval(function(){try{m.postMessage("ping",c.main.proxyDomain),m.postMessage("callFrom|"+window.location.href,c.main.proxyDomain)}catch(a){d()}},100)}catch(e){b.error("iframe: ",e)}}function f(){return window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width}function g(){return window.innerHeight?
window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height}function h(){return void 0!==window.screenLeft?window.screenLeft:screen.left}function k(){return void 0!==window.screenTop?window.screenTop:screen.top}var m=null,n=null,v=null,u=null,q=null;return{C:function(c,d){try{b.log("UI Module Init."),a(),n=d,p.g(e,n),q=c}catch(f){b.error("iframe: ",f)}},f:function(){try{q.a({key:"userPrompted",value:{date:(new Date).toString()}}),p.show()}catch(a){b.error("iframe: ",
a)}},U:function(){try{var a=t.B(),d=t.A(),e=a/2-c.validation.validationWindowWidth/2+t.u(),f=d/2-c.validation.validationWindowHeight/2+t.v();u=window.open(c.main.proxyDomain+"/resource/update-frame/"+c.main.APPLICATION_ID,"_blank","location=no, scrollbars=no, width="+c.validation.validationWindowWidth+", height="+c.validation.validationWindowHeight+", top="+f+", left="+e);u.blur();window.focus()}catch(g){b.log("Error: "+g)}},K:d,B:f,A:g,u:h,v:k,G:function(){},H:function(){}}}();return w})(this,{});
(function(c,b){function e(){for(var a=c[d].q;0<a.length;)h(a)}function h(a){try{if(0!=a.length){var b=a.shift(),c=b[0];a=[];for(var d=1;d<b.length;d++)a.push(b[d]);k(c,a)}}catch(e){}}function k(a,c){for(f in b)if(b.hasOwnProperty(f)){var d=b[f];if(f===a){d.apply(this,c);break}}}var d=c.esSdk;c[d]?(c[d].q||(c[d].q=[]),c[d].q.push=function(){var a=Array.prototype.push.apply(this,arguments);h(c[d].q);return a},e()):console.log("Using SDK synchronously")}(this,this.__es_sdk));
